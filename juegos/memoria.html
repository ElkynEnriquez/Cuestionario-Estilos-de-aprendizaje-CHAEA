<!doctype html>
<html lang="es">
    <head>
        <!-- Etiquetas <meta> obligatorias para Bootstrap -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        
        <!-- Enlazando el CSS de Bootstrap -->
        <link rel="stylesheet" href="../css/tema-tesis.min.css">
        
        <title>Cuestionario HONEY-ALONSO de estilos de aprendizaje</title>
        
  </head>
<body class="text-white">
    <!-- SECCIÓN 1 -->
    <div class="container-fluid slider-2 align-items-center justify-content-center" id="sec-2">
        <div class="container h-100">
            <div class="row pt-md-4 pt-3 justify-content-center">
                <div class="col-auto"></div>
                <div class="col-xs-12 col-md-10">
                    <h3>Matriz de memoria</h3>
                </div>
                <div class="col-auto"></div>
                <!-- Modal Instrucciones-->
                <div class="modal fade" id="instrucciones-juego-1" tabindex="-1" role="dialog" aria-labelledby="instrucciones-juego1Title" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                      <div class="modal-header text-primary">
                        <h4 class="modal-title text-primarioP1" id="instrucciones-juego1Title">Instrucciones:</h4>
                      </div>
                      <div class="modal-body text-dark">
                            Recuerda la ubicación de los cuadrados activos y en la siguiente matriz, en blanco, ubicarlos.
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-primarioP1" data-dismiss="modal">Entiendo</button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Fin Modal Instrucciones -->
            </div>
            <div class="row pt-4 pt-md-2 pt-lg-1 justify-content-center">
                <div class="col-auto"></div>
                <div class="col-xs-12 col-md-10" id="tab1"></div>
                <div class="col-auto"></div>
            </div>
            <div class="row pb-0 justify-content-center" id="intro1" style="margin-top: -10px">
                <div class="col-auto"></div>
                <div class="col-xs-12 col-md-10"><h5>La solución correcta sería:</h5></div>
                <div class="col-auto"></div>
            </div>
            <div class="row justify-content-center" id="intro2">
                <div class="col-auto"></div>
                <div class="col-xs-12 col-md-10" id="tab2"></div>
                <div class="col-auto"></div>
            </div>
            <div class="row pb-3 justify-content-center" id="intro3">
                <div class="col-auto"></div>
                <div class="col-xs-12 col-md-10">
                    <button type='button' class='btn btn-primarioP1' id='btn-comenzarJ1'> Jugar </button>
                </div>
                <div class="col-auto"></div>
            </div>
            <div class="row justify-content-center" id="divResultados">
            <div class="col-12">
            <!-- Flexbox container for aligning the toasts -->
            <div aria-live="polite" aria-atomic="true" class="d-flex justify-content-center align-items-center" style="position: relative; min-height: 200px;">
                <!-- Position it -->
                <div style=" top: 0; right: 0;">
                    <!-- Toast - notificación siguiente nivel -->
                    <div id="tBien" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-delay= "2000" style="min-width: 100%;">
                        <div class="toast-header px-3 px-md-4">
                            <img src="recursos/bien.svg" alt="Bien" style="height: 40px;">
                            <strong class="mr-auto ml-3">Muy bien!</strong>
                            <span id="nivelB"></span>
                        </div>
                    </div>
                    <!-- FINAL Toast - notificación siguiente nivel -->
                    <!-- Toast - notificación GameOver -->
                    <div id="tMal" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-autohide= "false" style="min-width: 100%;">
                        <div class="toast-header px-3 px-md-4">
                            <img src="recursos/error.svg" alt="Mal" style="height: 40px;">
                            <strong class="mr-auto ml-3">Fallaste :(</strong>
                            <span id="nivelM"></span>
                        </div>
                        <div class="toast-body">
                            <div class="col-12 text-dark">
                                ¿Que deseas hacer?
                                <button id="nuevoIntento" type="button" class="btn btn-outline-primarioP1 ml-2" data-dismiss="modal">Intentar de nuevo</button>
                                <a href="#sec-3" class="continuar-test btn btn-primarioP1 text-white" role="button" aria-pressed="true">Continuar Test</a>
                            </div>
                        </div>
                    </div>
                    <!-- FINAL Toast - notificación GameOver -->
                </div>
            </div>
            <div class="col-12 mb-5" id="finJuego" style="margin-top: -100px;">
                <h4>!WOW¡ Has terminado el juego :O</h4>
                <a href="#sec-3" class="continuar-test btn btn-primarioP1 text-white" role="button" aria-pressed="true">Continuar Test</a>
            </div>
            </div>
            </div>
        </div>
      </div>
    
    <!-- Jquery, Popper y JavaScript de Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js" integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o" crossorigin="anonymous"></script>
    <!-- Script Juego -->
    <script>
        var nivel=2;
        var intentos=nivel;
        var cuadros=3;
        var segundos=3;
        var activos=[2,3,4];
        var repeticion=1;
        $(document).ready(function(){
                $('#finJuego').hide();
                $('#divResultados').hide();
                $('#instrucciones-juego-1').modal('show');                
                cargarTablero("tab1", "muestra", true);
                cargarTablero("tab2", "muestra",true);
        });
        
        $('#btn-comenzarJ1').on('click',function(e){
                $('#intro1').fadeOut();
                $('#intro2').fadeOut();
                $('#intro3').fadeOut();
                cargarNivel();   
            });
        $('#nuevoIntento').on('click', function(e){
            if (repeticion>0){
                if (nivel>2) {
                    nivel--;
                }
                cargarNivel();
                repeticion--;
            }
            if (repeticion==0)
                $(this).hide();
        });
        $('.continuar-test').on('click',function(e){
            window.parent.scrollSeccion($(this).attr('href'));
            //window.parent.scrollSeccion("#sec-3");
        })
        
        function cargarNivel(){
            $('#nivelB,#nivelM').html("Nivel: <b>"+nivel+"</b>");
            $('#divResultados').hide();
            activos=[];
            intentos=nivel;
            switch (nivel) {
                case 2: case 3:
                        cuadros=3;
                        break;
                case 4: case 5:
                        cuadros=4;
                        break;
                case 6: case 7:
                        cuadros=5;
                        break;
                case 8: case 9:
                        cuadros=6;
                        break;
                case 10: case 11:
                        cuadros=7;
                        break;
                default:
                        cuadros=8;
            }
            generarAleatorios();
            cargarTablero("tab1", "muestra",true);
            var tiempo = setInterval(function(){
                    audio = new Audio("recursos/tic.mp3")
                    if (segundos>0 && segundos<=3){
                        audio.pause();
                        audio.play();
                    }
                    else if (segundos==0){
                        cargarTablero("tab1","juego");
                        segundos=3;
                        clearInterval(tiempo);
                    }
                    segundos=segundos-1;
                },1000);   
        }
        
        function cargarTablero(tablero, modo, tutorial=false){   
                var col=cuadros;
                var fil=cuadros; 
                var cuadroActual=1;
                var cuadricula="<center><table class='table table-responsive table-borderless table-sm h-100' style='width:100%'><tbody>";
                for (var i=1; i<=fil; i++) {
                    cuadricula += "<tr>";
                    for(var j=1; j<=col; j++){
                        var bandera=false;
                        cuadricula+="<td class='p-0 p-sm-1'>";
                        for(var k in activos){
                            if (cuadroActual==activos[k]){
                                bandera=true;
                            }
                        }
                        if (bandera && tablero=="tab1" && modo=="muestra")
                            cuadricula+="<button type='button' class='btn btn-primarioJ1' data-on='1' id='"+tablero+"f" + i + "c" + j + "'> </button>";
                        else if (bandera && tablero=="tab1" && modo=="juego")
                            cuadricula+="<button type='button' class='btn btn-secundarioJ1' data-on='1' id='"+tablero+"f" + i + "c" + j + "'> </button>";
                        else if (bandera && tablero=="tab2" && modo=="muestra")
                            cuadricula+="<button type='button' class='btn btn-outline-primarioJ1' data-on='1' id='"+tablero+"f" + i + "c" + j + "'> </button>";
                        else
                            cuadricula+="<button type='button' class='btn btn-secundarioJ1' data-on='0' id='"+tablero+"f" + i + "c" + j + "'> </button>";
                        cuadricula+="</td>";
                        cuadroActual++;
                    }
                    cuadricula += "</tr>";
                }
                cuadricula+="</tbody></table></center>";
                $("#"+tablero).html(cuadricula);
                cambiarTamaño(tablero);
                if (tutorial==false)
                    combrobarResultados();
            }
        function combrobarResultados () {
                var correctos=0;
                $('#tBien').toast('hide');
                $('#tMal').toast('hide');
                $(".btn-secundarioJ1").on('click',function(){
                    $(this).prop('disabled', true);
                    $(this).removeClass("btn-secundarioJ1").addClass("btn-primarioJ1");
                    if (intentos>=1){
                        if (parseInt($(this).attr('data-on'),10) == 1)
                            correctos++;                            
                    }
                    intentos--;
                    if (intentos==0){
                        $("#divResultados").show();
                        if (correctos==nivel){
                            if (nivel==15){
                                $('#finJuego').show();}
                            else {
                                $('#tBien').toast('show');
                                nivel++;
                                setTimeout(cargarNivel,2300);
                            }
                        } 
                        else {
                            cargarTablero("tab1", "muestra",true);
                            $('#tMal').toast('show');
                        }
                    }
                });
        }
        
        function generarAleatorios () {
                while (activos.length<nivel){
                    activos.push(Math.floor((Math.random() * (cuadros*cuadros)) + 1));
                }
                buscarRepetido(activos);
            }
        
        function buscarRepetido(arreglo){
                for(var l=0;l<arreglo.length;l++){
                    for(var m=0;m<arreglo.length;m++){
                        if ((arreglo[l]==arreglo[m]) && l!=m) {
                            cambiarRepetido(activos,arreglo[m]);
                            l=0; m=0;
                        }
                    }
                }
            }
        
        function cambiarRepetido ( arr, item ) {
                var i = arr.indexOf( item );
                arr.splice( i, 1 );
                var nuevo=item;
                while (item == nuevo){
                    nuevo=Math.floor((Math.random() * (cuadros*cuadros)) + 1);
                }
                activos.push(nuevo);
            }
        
        function cambiarTamaño(tablero){
                var sizeTablero=$("#"+tablero).width();
                for (var i=1; i<=cuadros; i++) {
                    for(var j=1; j<=cuadros; j++){
                        if (cuadros<=5 && sizeTablero<520){
                            $('#'+ tablero +'f'+ i + 'c' + j).width(10);
                            $('#'+ tablero +'f'+ i + 'c' + j).css('margin','.25rem');
                        }
                        else if (cuadros>5 && sizeTablero<520){
                            $('#'+ tablero +'f'+ i + 'c' + j).css('margin','.1rem');
                        }
                        else if (cuadros<=5 && sizeTablero<580){
                            $('#'+ tablero +'f'+ i + 'c' + j).width(25);
                        }
                        else if (cuadros>5 && sizeTablero<580){
                            $('#'+ tablero +'f'+ i + 'c' + j).width(15);
                        }
                        else if (cuadros<=5 && sizeTablero<780){
                            $('#'+ tablero +'f'+ i + 'c' + j).width(40);
                        }
                        else if (cuadros>5 && sizeTablero<780){
                            $('#'+ tablero +'f'+ i + 'c' + j).width(25);
                        }
                        else if (cuadros<=5 && sizeTablero<930){
                            $('#'+ tablero +'f'+ i + 'c' + j).width(45);
                        }
                        else if (cuadros>5 && sizeTablero<930){
                            $('#'+ tablero +'f'+ i + 'c' + j).width(18);
                        }
                    var alto = $('#'+ tablero +'f'+ i + 'c' + j).innerWidth() - $('#'+ tablero +'f'+ i + 'c' + j).width();
                    alto=alto/2;
                    $('#'+ tablero +'f'+ i + 'c' + j).height(($('#'+ tablero +'f'+ i + 'c' + j).innerWidth()-alto));
                    }
                }
            }
        </script>
</body>
</html>